# syntax=docker/dockerfile:1
FROM eclipse-temurin:21-jdk AS build
WORKDIR /workspace

COPY gradle gradle
COPY gradlew .
COPY settings.gradle .
COPY gradle.properties .
COPY app app

RUN chmod +x gradlew \
    && ./gradlew :app:bootJar --no-daemon

FROM eclipse-temurin:21-jre
WORKDIR /app

COPY --from=build /workspace/app/build/libs/app-0.0.1-SNAPSHOT.jar app.jar

ENV SPRING_MAIN_APPLICATION_CLASS=com.example.demo.api2.Api2Application \
    SERVER_PORT=8081 \
    SPRING_PROFILES_ACTIVE=api2 \
    JAVA_OPTS=""

EXPOSE 8081

ENTRYPOINT ["sh", "-c", "exec java -Dspring.main.application-class=${SPRING_MAIN_APPLICATION_CLASS} ${JAVA_OPTS} -jar app.jar"]
