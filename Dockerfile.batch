# syntax=docker/dockerfile:1
FROM eclipse-temurin:21-jdk AS build
WORKDIR /workspace

COPY gradle gradle
COPY gradlew .
COPY settings.gradle .
COPY gradle.properties .
COPY app app

RUN chmod +x gradlew \
    && ./gradlew :app:bootJar --no-daemon

FROM eclipse-temurin:21-jre
WORKDIR /app

COPY --from=build /workspace/app/build/libs/app-0.0.1-SNAPSHOT.jar app.jar

ENV SPRING_MAIN_APPLICATION_CLASS=com.example.demo.batch.BatchApplication \
    SPRING_BATCH_JOB_NAME=sampleJob \
    JAVA_OPTS=""

ENTRYPOINT ["sh", "-c", "exec java -Dspring.main.application-class=${SPRING_MAIN_APPLICATION_CLASS} ${JAVA_OPTS} -jar app.jar --spring.batch.job.names=${SPRING_BATCH_JOB_NAME}"]
